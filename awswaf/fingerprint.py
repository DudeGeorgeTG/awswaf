import json
import time
import uuid
import zlib
from awswaf.crypto import encrypt

def encode_with_crc(obj):
    payload = json.dumps(obj, separators=(',', ':')).encode('utf-8')
    crc = zlib.crc32(payload) & 0xFFFFFFFF
    hex_crc = f"{crc:08x}"
    checksum = hex_crc.encode('ascii').upper()
    return checksum, checksum + b"#" + payload

def get_fp():
    ts = int(time.time() * 1000)
    fp = {
        "metrics": {
            "fp2": 1,
            "browser": 0,
            "capabilities": 1,
            "gpu": 6,
            "dnt": 0,
            "math": 0,
            "screen": 0,
            "navigator": 0,
            "auto": 0,
            "stealth": 0,
            "subtle": 0,
            "canvas": 7,
            "formdetector": 0,
            "be": 0
        },
        "start": ts,
        "flashVersion": None,
        "plugins": [
            {
                "name": "PDF Viewer",
                "str": "PDF Viewer "
            },
            {
                "name": "Chrome PDF Viewer",
                "str": "Chrome PDF Viewer "
            },
            {
                "name": "Chromium PDF Viewer",
                "str": "Chromium PDF Viewer "
            },
            {
                "name": "Microsoft Edge PDF Viewer",
                "str": "Microsoft Edge PDF Viewer "
            },
            {
                "name": "WebKit built-in PDF",
                "str": "WebKit built-in PDF "
            }
        ],
        "dupedPlugins": "PDF Viewer Chrome PDF Viewer Chromium PDF Viewer Microsoft Edge PDF Viewer WebKit built-in PDF ||1920-1080-1032-24-*-*-*",
        "screenInfo": "1920-1080-1032-24-*-*-*",
        "referrer": "",
        "userAgent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36",
        "location": "https://www.binance.com/",
        "webDriver": False,
        "capabilities": {
            "css": {
                "textShadow": 1,
                "WebkitTextStroke": 1,
                "boxShadow": 1,
                "borderRadius": 1,
                "borderImage": 1,
                "opacity": 1,
                "transform": 1,
                "transition": 1
            },
            "js": {
                "audio": True,
                "geolocation": True,
                "localStorage": "supported",
                "touch": False,
                "video": True,
                "webWorker": True
            },
            "elapsed": 1
        },
        "gpu": {
            "vendor": "Google Inc. (AMD)",
            "model": "ANGLE (AMD, AMD Radeon RX 5700 (0x0000731F) Direct3D11 vs_5_0 ps_5_0, D3D11)",
            "extensions": [
                "ANGLE_instanced_arrays",
                "EXT_blend_minmax",
                "EXT_clip_control",
                "EXT_color_buffer_half_float",
                "EXT_depth_clamp",
                "EXT_disjoint_timer_query",
                "EXT_float_blend",
                "EXT_frag_depth",
                "EXT_polygon_offset_clamp",
                "EXT_shader_texture_lod",
                "EXT_texture_compression_bptc",
                "EXT_texture_compression_rgtc",
                "EXT_texture_filter_anisotropic",
                "EXT_texture_mirror_clamp_to_edge",
                "EXT_sRGB",
                "KHR_parallel_shader_compile",
                "OES_element_index_uint",
                "OES_fbo_render_mipmap",
                "OES_standard_derivatives",
                "OES_texture_float",
                "OES_texture_float_linear",
                "OES_texture_half_float",
                "OES_texture_half_float_linear",
                "OES_vertex_array_object",
                "WEBGL_blend_func_extended",
                "WEBGL_color_buffer_float",
                "WEBGL_compressed_texture_s3tc",
                "WEBGL_compressed_texture_s3tc_srgb",
                "WEBGL_debug_renderer_info",
                "WEBGL_debug_shaders",
                "WEBGL_depth_texture",
                "WEBGL_draw_buffers",
                "WEBGL_lose_context",
                "WEBGL_multi_draw",
                "WEBGL_polygon_mode"
            ]
        },
        "dnt": None,
        "math": {
            "tan": "-1.4214488238747245",
            "sin": "0.8178819121159085",
            "cos": "-0.5753861119575491"
        },
        "automation": {
            "wd": {
                "properties": {
                    "document": [],
                    "window": [],
                    "navigator": []
                }
            },
            "phantom": {
                "properties": {
                    "window": []
                }
            }
        },
        "stealth": {
            "t1": 0,
            "t2": 0,
            "i": 1,
            "mte": 0,
            "mtd": False
        },
        "crypto": {
            "crypto": 1,
            "subtle": 1,
            "encrypt": True,
            "decrypt": True,
            "wrapKey": True,
            "unwrapKey": True,
            "sign": True,
            "verify": True,
            "digest": True,
            "deriveBits": True,
            "deriveKey": True,
            "getRandomValues": True,
            "randomUUID": True
        },
        "canvas": {
            "hash": 645182195,
            "emailHash": None,
            "histogramBins": [
                14573,
                31,
                59,
                36,
                42,
                67,
                27,
                28,
                39,
                32,
                38,
                48,
                46,
                32,
                35,
                67,
                55,
                21,
                66,
                24,
                25,
                24,
                23,
                37,
                50,
                27,
                42,
                14,
                31,
                18,
                48,
                46,
                33,
                57,
                26,
                12,
                38,
                25,
                26,
                27,
                34,
                33,
                18,
                9,
                34,
                24,
                10,
                36,
                33,
                39,
                33,
                38,
                66,
                10,
                23,
                20,
                22,
                20,
                5,
                17,
                48,
                45,
                11,
                14,
                18,
                18,
                26,
                14,
                14,
                15,
                8,
                17,
                17,
                17,
                39,
                15,
                11,
                12,
                43,
                67,
                29,
                18,
                19,
                15,
                29,
                14,
                14,
                17,
                22,
                56,
                27,
                27,
                16,
                18,
                20,
                11,
                36,
                20,
                25,
                112,
                78,
                29,
                547,
                25,
                9,
                39,
                31,
                16,
                14,
                15,
                11,
                36,
                24,
                13,
                17,
                18,
                15,
                31,
                20,
                23,
                70,
                39,
                19,
                11,
                31,
                30,
                28,
                27,
                17,
                60,
                32,
                55,
                20,
                12,
                17,
                40,
                29,
                36,
                70,
                16,
                23,
                17,
                12,
                16,
                14,
                12,
                25,
                21,
                10,
                11,
                60,
                19,
                8,
                92,
                9,
                52,
                29,
                20,
                8,
                31,
                10,
                16,
                17,
                22,
                50,
                35,
                6,
                14,
                11,
                15,
                13,
                28,
                17,
                40,
                12,
                23,
                60,
                80,
                7,
                10,
                9,
                46,
                9,
                24,
                10,
                7,
                18,
                10,
                7,
                54,
                16,
                19,
                7,
                11,
                61,
                23,
                12,
                10,
                65,
                10,
                17,
                55,
                33,
                51,
                67,
                71,
                86,
                7,
                24,
                15,
                8,
                14,
                25,
                13,
                37,
                29,
                17,
                30,
                23,
                31,
                26,
                20,
                68,
                84,
                32,
                68,
                19,
                42,
                54,
                22,
                21,
                38,
                14,
                39,
                21,
                33,
                35,
                17,
                20,
                71,
                123,
                44,
                45,
                34,
                64,
                37,
                31,
                79,
                38,
                31,
                79,
                55,
                44,
                62,
                43,
                13188
            ]
        },
        "formDetected": False,
        "numForms": 0,
        "numFormElements": 0,
        "be": {
            "si": False
        },
        "end": ts + 200,
        "errors": [],
        "version": "2.3.0",
        "id": str(uuid.uuid4()),
    }
    checksum, data = encode_with_crc(fp)
    return checksum.decode(), encrypt(data)
